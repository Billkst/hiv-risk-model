# HIV风险评估模型 - 评分可解释性文档

**版本**: 1.1  
**更新日期**: 2025-11-04  
**作者**: 刘俊希

---

## 📋 目录

1. [概述](#概述)
2. [评分机制](#评分机制)
3. [特征贡献度分析](#特征贡献度分析)
4. [风险等级解释](#风险等级解释)
5. [关键特征说明](#关键特征说明)
6. [实际案例分析](#实际案例分析)
7. [使用指南](#使用指南)

---

## 概述

### 为什么需要可解释性？

HIV风险评估模型的预测结果直接影响疾控决策和资源分配。为了让决策者信任和理解模型，我们提供了完整的可解释性分析：

- **透明性**: 清楚地展示每个特征对风险评分的影响
- **可信度**: 验证模型学习到的规律符合医学常识
- **可操作性**: 指导具体的干预措施
- **可审计性**: 支持模型决策的追溯和审查

### 可解释性方法

我们采用两种互补的方法：

1. **特征贡献度分析** - 量化每个特征对预测结果的贡献
   - 基于SHAP (SHapley Additive exPlanations) 理论
   - 快速近似方法（生产环境）
   - 精确SHAP方法（研究分析）

2. **全局特征重要性** - 识别最重要的风险因素
   - 基于模型内置的feature_importances_
   - 统计所有样本的平均影响

---

## 评分机制

### 风险评分计算公式

```
风险分数 = 基准分数 + Σ(特征贡献度)
```

**组成部分**:

1. **基准分数 (Base Value)**
   - 定义: 所有区县的平均风险等级
   - 当前值: 1.52（介于等级1和等级2之间）
   - 含义: 如果不考虑任何特征，预测的默认风险等级

2. **特征贡献度 (Feature Contribution)**
   - 定义: 每个特征对最终预测的影响
   - 正贡献: 增加风险（推高风险等级）
   - 负贡献: 降低风险（拉低风险等级）
   - 总和: 所有特征贡献度之和 = 预测值 - 基准值

### 风险等级映射

模型输出3级风险，映射到5级风险评估：

| 模型输出 | 风险等级 | 分数范围 | 描述 | 颜色 |
|---------|---------|---------|------|------|
| 1 | 1-2级 | 0-40分 | 低风险 | 🟢 绿色 |
| 2 | 3级 | 40-60分 | 中等风险 | 🟡 黄色 |
| 3 | 4-5级 | 60-100分 | 高风险 | 🔴 红色 |

**5级细分标准**:
- **等级1 (极低风险)**: 0-20分 - 疫情控制良好
- **等级2 (低风险)**: 20-40分 - 疫情较为稳定
- **等级3 (中等风险)**: 40-60分 - 需要关注
- **等级4 (高风险)**: 60-80分 - 需要重点关注
- **等级5 (极高风险)**: 80-100分 - 疫情严重

---

## 特征贡献度分析

### 什么是特征贡献度？

特征贡献度表示某个特征对预测结果的影响大小和方向：

- **正贡献 (+)**: 该特征使风险等级升高
- **负贡献 (-)**: 该特征使风险等级降低
- **贡献值大小**: 影响的强度

### 计算方法

**快速近似方法**（生产环境，< 2ms）:

```
特征贡献度 ≈ 特征值 × 特征重要性 × 归一化系数
```

**精确SHAP方法**（研究分析，2-3秒）:

```
特征贡献度 = SHAP值（基于博弈论的Shapley值）
```

### 可加性验证

特征贡献度满足可加性原则：

```
预测值 = 基准值 + Σ(所有特征的贡献度)
```

这保证了解释的完整性和一致性。

---

## 风险等级解释

### 等级1-2：低风险区域

**典型特征**:
- ✅ 治疗覆盖率高 (> 95%)
- ✅ 病毒抑制比例高 (> 90%)
- ✅ 筛查覆盖率高
- ✅ 新报告病例少
- ✅ 感染率低

**主要负贡献特征**（降低风险）:
1. 筛查人数多 → 早发现早治疗
2. 治疗覆盖率高 → 控制传播
3. 病毒抑制比例高 → 降低传染性
4. 干预覆盖率高 → 预防新发感染

**建议措施**:
- 保持现有防控措施
- 继续监测重点人群
- 维持高筛查覆盖率

### 等级3：中等风险区域

**典型特征**:
- ⚠️ 存活数中等
- ⚠️ 新报告病例稳定
- ⚠️ 治疗覆盖率中等 (85-95%)
- ⚠️ 部分高危人群干预不足

**主要正贡献特征**（增加风险）:
1. 存活数较多 → 疫情基数大
2. 新报告持续 → 仍有新发感染
3. 高危人群规模大 → 传播风险高

**主要负贡献特征**（降低风险）:
1. 治疗覆盖率尚可 → 部分控制传播
2. 筛查工作持续 → 发现潜在感染者

**建议措施**:
- 加强高危人群干预
- 提高治疗覆盖率到95%以上
- 增加筛查频次
- 重点关注传播途径

### 等级4-5：高风险区域

**典型特征**:
- 🔴 存活数多 (> 1000)
- 🔴 新报告病例多 (> 100)
- 🔴 感染率高 (> 0.5%)
- 🔴 高危人群规模大
- 🔴 干预覆盖率低
- 🔴 治疗覆盖率低 (< 85%)

**主要正贡献特征**（增加风险）:
1. 存活数多 → 疫情严重
2. 新报告多 → 传播活跃
3. 感染率高 → 流行强度大
4. 商业性传播占比高 → 高危行为多
5. 暗娼/MSM规模大 → 重点人群基数大
6. 检测阳性率高 → 隐性感染多

**建议措施**:
- 🚨 紧急加强干预措施
- 🚨 提高治疗覆盖率（目标95%）
- 🚨 扩大筛查范围
- 🚨 重点人群专项行动
- 🚨 增加医疗资源投入

---

## 关键特征说明

### Top 10 最重要特征

基于190个区县的数据分析，以下是对风险评估影响最大的10个特征：



#### 1. 存活数 (重要性: 19.85%)

**定义**: 现存活HIV感染者/病人总数

**影响方向**: 正相关（存活数越多，风险越高）

**医学解释**:
- 存活数反映疫情的累积规模
- 存活数多意味着传播源多
- 需要更多医疗资源和管理

**典型值范围**:
- 低风险区: < 500人
- 中风险区: 500-1500人
- 高风险区: > 1500人

**干预建议**:
- 加强存活病例的治疗管理
- 提高病毒抑制率
- 减少二代传播

---

#### 2. 新报告 (重要性: 18.12%)

**定义**: 本年度新报告HIV感染者/病人数

**影响方向**: 正相关（新报告越多，风险越高）

**医学解释**:
- 新报告反映疫情的活跃程度
- 新报告多说明传播仍在持续
- 是疫情趋势的重要指标

**典型值范围**:
- 低风险区: < 30例/年
- 中风险区: 30-100例/年
- 高风险区: > 100例/年

**干预建议**:
- 加强预防宣传
- 扩大高危人群干预
- 提高检测覆盖率

---

#### 3. 病载小于50占现存活比例 (重要性: 7.05%)

**定义**: 病毒载量<50拷贝/ml的感染者占存活总数的比例

**影响方向**: 负相关（比例越高，风险越低）

**医学解释**:
- 病毒载量<50表示病毒被有效抑制
- 抑制率高意味着传染性低
- 是治疗效果的核心指标

**典型值范围**:
- 低风险区: > 90%
- 中风险区: 80-90%
- 高风险区: < 80%

**干预建议**:
- 提高治疗依从性
- 加强病毒载量监测
- 及时调整治疗方案

---

#### 4. 感染率 (重要性: 5.39%)

**定义**: HIV感染者占总人口的比例

**影响方向**: 正相关（感染率越高，风险越高）

**医学解释**:
- 感染率反映疫情的流行强度
- 是国际通用的疫情评估指标
- 影响疫情控制难度

**典型值范围**:
- 低风险区: < 0.1%
- 中风险区: 0.1-0.3%
- 高风险区: > 0.3%

**干预建议**:
- 综合防控措施
- 降低新发感染
- 提高治疗覆盖率

---

#### 5. 按人数筛查覆盖率 (重要性: 5.10%)

**定义**: 接受HIV筛查的人数占总人口的比例

**影响方向**: 负相关（覆盖率越高，风险越低）

**医学解释**:
- 筛查是早发现的关键
- 覆盖率高能及时发现感染者
- 早发现早治疗降低传播

**典型值范围**:
- 低风险区: > 30%
- 中风险区: 20-30%
- 高风险区: < 20%

**干预建议**:
- 扩大筛查范围
- 提高重点人群检测频次
- 推广自愿咨询检测

---

#### 6. 存活_10- (10-14岁年龄段占比) (重要性: 3.33%)

**定义**: 10-14岁感染者占存活总数的比例

**影响方向**: 正相关（比例越高，风险越高）

**医学解释**:
- 青少年感染提示母婴传播或性传播
- 需要特殊关注和保护
- 影响长期疫情控制

**典型值范围**:
- 低风险区: < 1%
- 中风险区: 1-3%
- 高风险区: > 3%

**干预建议**:
- 加强母婴阻断
- 青少年性教育
- 特殊人群保护

---

#### 7. 筛查人数 (重要性: 3.29%)

**定义**: 接受HIV筛查的总人数（去重）

**影响方向**: 负相关（筛查人数越多，风险越低）

**医学解释**:
- 筛查人数多说明检测工作到位
- 能及时发现潜在感染者
- 是主动发现的重要手段

**典型值范围**:
- 低风险区: > 20万人/年
- 中风险区: 10-20万人/年
- 高风险区: < 10万人/年

**干预建议**:
- 增加检测点
- 扩大检测人群
- 提高检测可及性

---

#### 8. 新报告_60- (60-64岁年龄段占比) (重要性: 2.79%)

**定义**: 60-64岁新报告感染者占新报告总数的比例

**影响方向**: 正相关（比例越高，风险越高）

**医学解释**:
- 老年感染者增多是新趋势
- 提示老年人群防控薄弱
- 需要针对性干预

**典型值范围**:
- 低风险区: < 5%
- 中风险区: 5-10%
- 高风险区: > 10%

**干预建议**:
- 加强老年人群宣传教育
- 提高老年人检测意识
- 关注老年人性健康

---

#### 9. 治疗覆盖率 (重要性: 2.10%)

**定义**: 接受抗病毒治疗的感染者占存活总数的比例

**影响方向**: 负相关（覆盖率越高，风险越低）

**医学解释**:
- 治疗是控制疫情的核心
- 治疗覆盖率高能降低传播
- 国际目标：95%以上

**典型值范围**:
- 低风险区: > 95%
- 中风险区: 90-95%
- 高风险区: < 90%

**干预建议**:
- 提高治疗可及性
- 加强随访管理
- 提高依从性

---

#### 10. 挡获暗娼人次数 (重要性: 2.00%)

**定义**: 公安部门挡获暗娼的人次数

**影响方向**: 正相关（人次越多，风险越高）

**医学解释**:
- 反映商业性行为的活跃程度
- 暗娼是HIV传播的高危人群
- 需要加强干预和检测

**典型值范围**:
- 低风险区: < 100人次/年
- 中风险区: 100-500人次/年
- 高风险区: > 500人次/年

**干预建议**:
- 加强暗娼人群干预
- 提高安全套使用率
- 定期HIV检测

---

## 实际案例分析

### 案例1: 低风险区县（等级1）

**基本信息**:
- 人口: 50万
- 存活数: 200人
- 新报告: 15例/年
- 感染率: 0.04%

**预测结果**:
- 风险等级: 1（极低风险）
- 风险分数: 18.5分
- 置信度: 92%

**特征贡献度分析**:

| 特征 | 特征值 | 贡献度 | 说明 |
|------|--------|--------|------|
| 筛查人数 | 180,000 | -0.45 | 筛查工作到位 ✅ |
| 治疗覆盖率 | 98.5% | -0.32 | 治疗覆盖率高 ✅ |
| 病毒抑制比例 | 96.2% | -0.28 | 治疗效果好 ✅ |
| 存活数 | 200 | +0.15 | 疫情基数小 |
| 新报告 | 15 | +0.08 | 新发感染少 |

**解释**:
- 该区县筛查工作做得很好（18万人/年），贡献度-0.45，大幅降低风险
- 治疗覆盖率和病毒抑制率都很高，有效控制传播
- 存活数和新报告都较少，疫情基数小
- 综合评估为极低风险，建议保持现有措施

---

### 案例2: 中等风险区县（等级3）

**基本信息**:
- 人口: 100万
- 存活数: 1,200人
- 新报告: 80例/年
- 感染率: 0.12%

**预测结果**:
- 风险等级: 3（中等风险）
- 风险分数: 52.3分
- 置信度: 85%

**特征贡献度分析**:

| 特征 | 特征值 | 贡献度 | 说明 |
|------|--------|--------|------|
| 存活数 | 1,200 | +0.38 | 疫情基数较大 ⚠️ |
| 新报告 | 80 | +0.29 | 新发感染持续 ⚠️ |
| 感染率 | 0.12% | +0.18 | 流行强度中等 ⚠️ |
| 暗娼规模 | 800 | +0.15 | 高危人群多 ⚠️ |
| 治疗覆盖率 | 92% | -0.22 | 治疗覆盖尚可 |
| 筛查人数 | 120,000 | -0.18 | 筛查工作持续 |

**解释**:
- 存活数1,200人，贡献度+0.38，是主要风险因素
- 新报告80例，说明传播仍在持续
- 治疗覆盖率92%，虽然不错但未达到95%目标
- 暗娼规模较大，需要加强干预
- 综合评估为中等风险，建议加强防控

**改进建议**:
1. 提高治疗覆盖率从92%到95%以上
2. 加强暗娼人群干预，提高覆盖率
3. 扩大筛查范围，增加检测人数
4. 重点关注新报告病例的传播途径

---

### 案例3: 高风险区县（等级5）

**基本信息**:
- 人口: 150万
- 存活数: 3,500人
- 新报告: 200例/年
- 感染率: 0.23%

**预测结果**:
- 风险等级: 5（极高风险）
- 风险分数: 85.7分
- 置信度: 88%

**特征贡献度分析**:

| 特征 | 特征值 | 贡献度 | 说明 |
|------|--------|--------|------|
| 存活数 | 3,500 | +0.82 | 疫情严重 🔴 |
| 新报告 | 200 | +0.65 | 传播活跃 🔴 |
| 感染率 | 0.23% | +0.48 | 流行强度高 🔴 |
| 商业性传播占比 | 35% | +0.32 | 高危行为多 🔴 |
| 城市MSM规模 | 5,000 | +0.28 | 重点人群大 🔴 |
| 暗娼规模 | 2,000 | +0.25 | 高危人群多 🔴 |
| 治疗覆盖率 | 85% | -0.15 | 治疗覆盖不足 ⚠️ |
| 病毒抑制比例 | 82% | -0.12 | 治疗效果欠佳 ⚠️ |

**解释**:
- 存活数3,500人，贡献度+0.82，是最大风险因素
- 新报告200例/年，传播非常活跃
- 商业性传播占比35%，高危行为突出
- MSM和暗娼规模都很大，重点人群基数大
- 治疗覆盖率仅85%，远低于95%目标
- 病毒抑制比例82%，治疗效果不理想
- 综合评估为极高风险，需要紧急干预

**紧急改进措施**:
1. 🚨 立即提高治疗覆盖率到95%以上
2. 🚨 加强病毒载量监测，提高抑制率到90%以上
3. 🚨 MSM和暗娼人群专项干预行动
4. 🚨 扩大筛查范围，增加检测频次
5. 🚨 加强商业性行为场所的干预
6. 🚨 增加医疗资源和人员投入

---

## 使用指南

### 如何解读预测结果

当你收到一个区县的风险评估报告时，按以下步骤解读：

**步骤1: 查看风险等级和分数**
```
风险等级: 3（中等风险）
风险分数: 52.3分
置信度: 85%
```
- 等级3表示需要关注
- 分数52.3在中等风险范围（40-60分）
- 置信度85%表示预测较为可靠

**步骤2: 查看Top 5正贡献特征（增加风险的因素）**
```
1. 存活数: 1,200 → +0.38
2. 新报告: 80 → +0.29
3. 感染率: 0.12% → +0.18
4. 暗娼规模: 800 → +0.15
5. 商业性传播占比: 25% → +0.12
```
- 这些是导致风险升高的主要因素
- 贡献度越大，影响越大
- 重点关注贡献度>0.2的特征

**步骤3: 查看Top 5负贡献特征（降低风险的因素）**
```
1. 筛查人数: 120,000 → -0.18
2. 治疗覆盖率: 92% → -0.22
3. 病毒抑制比例: 88% → -0.15
4. 暗娼干预人数: 600 → -0.10
5. MSM干预人数: 800 → -0.08
```
- 这些是降低风险的保护因素
- 说明哪些工作做得好
- 可以继续保持和加强

**步骤4: 制定干预策略**

基于特征贡献度分析，制定针对性措施：

1. **针对正贡献特征**（减少风险因素）
   - 存活数多 → 加强治疗管理
   - 新报告多 → 加强预防干预
   - 高危人群大 → 专项干预行动

2. **强化负贡献特征**（增强保护因素）
   - 提高治疗覆盖率
   - 扩大筛查范围
   - 增加干预人数

3. **优先级排序**
   - 优先处理贡献度绝对值>0.3的特征
   - 关注可快速改善的指标（如治疗覆盖率）
   - 长期关注结构性因素（如人群规模）

---

### API调用示例

**请求**:
```bash
curl -X POST http://localhost:5000/v1/predict \
  -H "Content-Type: application/json" \
  -d '{
    "features": {
      "存活数": 1200,
      "新报告": 80,
      "感染率": 0.12,
      "治疗覆盖率": 92.0,
      "病毒抑制比例": 88.0,
      ...
    },
    "include_contributions": true
  }'
```

**响应**:
```json
{
  "success": true,
  "prediction": {
    "risk_level": 3,
    "risk_description": "中等风险",
    "risk_score": 52.3,
    "confidence": 0.85,
    "confidence_percent": "85.00%"
  },
  "feature_contributions": {
    "base_value": 1.52,
    "prediction": 3.0,
    "top_positive": [
      {
        "feature": "存活数",
        "value": 1200,
        "contribution": 0.38
      },
      {
        "feature": "新报告",
        "value": 80,
        "contribution": 0.29
      }
    ],
    "top_negative": [
      {
        "feature": "治疗覆盖率",
        "value": 92.0,
        "contribution": -0.22
      },
      {
        "feature": "筛查人数",
        "value": 120000,
        "contribution": -0.18
      }
    ]
  }
}
```

---

## 附录

### A. 特征完整列表

模型使用110个特征，分为以下类别：

1. **基础疫情数据** (2个): 存活数、感染率
2. **年龄分布** (34个): 存活和新报告的17个年龄段
3. **传播途径** (16个): 存活和新报告的8种途径
4. **治疗指标** (5个): 治疗覆盖率、病毒抑制比例等
5. **高危人群干预** (30个): 暗娼、MSM、吸毒者等
6. **人群规模** (6个): 各类高危人群规模估计
7. **筛查数据** (5个): 筛查人数、覆盖率等
8. **公安挡获** (6个): 暗娼、嫖客挡获数据
9. **医疗资源** (6个): 医疗机构、床位、人员等

### B. 模型性能指标

- **F1 Score**: 0.87
- **准确率**: 0.89
- **响应时间**: < 50ms
- **训练样本**: 190个区县
- **模型类型**: Gradient Boosting Classifier

### C. 参考文献

1. Lundberg, S. M., & Lee, S. I. (2017). A unified approach to interpreting model predictions. NeurIPS.
2. 中国疾病预防控制中心. (2023). 艾滋病防治工作指南.
3. UNAIDS. (2023). 95-95-95 Target.

---

**文档版本**: 1.1  
**最后更新**: 2025-11-04  
**维护者**: 刘俊希  
**联系方式**: [email]
