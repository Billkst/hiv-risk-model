# 可视化图表解读指南

**版本**: 1.0  
**更新日期**: 2025-11-04

---

## 📊 三个图表的作用

### 图表1: 特征贡献度瀑布图 (Waterfall Chart)

**文件名**: `contributions_waterfall.png`

**作用**: 显示Top 15个特征对预测结果的贡献

**适用场景**:
- 理解为什么是这个风险等级
- 识别主要风险因素
- 制定针对性干预措施

---

### 图表2: Top正负贡献对比图 (Comparison Chart)

**文件名**: `contributions_comparison.png`

**作用**: 左右对比显示增加风险和降低风险的Top 5因素

**适用场景**:
- 快速了解风险因素
- 对比保护因素和风险因素
- 汇报和展示

---

### 图表3: 全局特征重要性图 (Global Importance Chart)

**文件名**: `global_importance.png`

**作用**: 显示模型中Top 20最重要的特征

**适用场景**:
- 了解模型关注点
- 识别关键指标
- 指导数据收集

---

## 🎯 如何解读图表

### 图表1: 瀑布图解读

**图表结构**:
```
特征名称 (纵轴)  |  =========> (横轴: 贡献度)
存活数          |  =============> +0.38
新报告          |  ==========> +0.29
治疗覆盖率       |  <======== -0.22
```

**颜色含义**:
- 🔴 **红色条**: 正贡献（增加风险）
- 🔵 **蓝色条**: 负贡献（降低风险）

**数值含义**:
- **正值 (+)**: 该特征使风险等级升高
  - 例如: 存活数 +0.38 → 存活数多导致风险增加
- **负值 (-)**: 该特征使风险等级降低
  - 例如: 治疗覆盖率 -0.22 → 治疗覆盖率高降低风险

**贡献度大小**:
- |贡献度| > 0.3: **强影响** ⚠️ 重点关注
- 0.1 < |贡献度| < 0.3: **中等影响**
- |贡献度| < 0.1: **弱影响**

**解读示例**:

假设图表显示：
```
存活数: +0.82 (红色，很长的条)
新报告: +0.65 (红色，长条)
感染率: +0.48 (红色，中等条)
治疗覆盖率: -0.22 (蓝色，短条)
筛查人数: -0.18 (蓝色，短条)
```

**解读**:
1. **主要风险因素**: 存活数多(+0.82)、新报告多(+0.65)、感染率高(+0.48)
2. **保护因素**: 治疗覆盖率(-0.22)、筛查人数(-0.18)有一定保护作用
3. **结论**: 这是一个疫情基数大、传播活跃的高风险区县
4. **建议**: 
   - 加强治疗管理（存活数多）
   - 加强预防干预（新报告多）
   - 提高治疗覆盖率（目前保护作用不够强）

---

### 图表2: 对比图解读

**图表结构**:
```
左侧（红色）              右侧（蓝色）
Top 5 正贡献             Top 5 负贡献
（增加风险的因素）         （降低风险的因素）

存活数 +0.82            治疗覆盖率 -0.22
新报告 +0.65            筛查人数 -0.18
感染率 +0.48            病毒抑制比例 -0.15
```

**如何使用**:

1. **快速判断**:
   - 左侧条长 → 风险因素多/强
   - 右侧条长 → 保护因素多/强

2. **对比分析**:
   - 左侧比右侧长很多 → 高风险区县
   - 左右差不多 → 中等风险区县
   - 右侧比左侧长 → 低风险区县

3. **制定措施**:
   - 针对左侧：减少风险因素
   - 针对右侧：增强保护因素

**解读示例**:

假设图表显示：
```
左侧（增加风险）:          右侧（降低风险）:
存活数 +0.82 ========>   治疗覆盖率 -0.22 ===>
新报告 +0.65 ======>     筛查人数 -0.18 ==>
感染率 +0.48 ====>       病毒抑制 -0.15 ==>
```

**解读**:
- 左侧条明显比右侧长 → 风险因素占主导
- 存活数贡献最大 → 疫情基数是核心问题
- 右侧保护因素较弱 → 防控措施需要加强

**建议措施**:
1. **短期**: 提高治疗覆盖率（从当前水平提升到95%以上）
2. **中期**: 扩大筛查范围（增加筛查人数）
3. **长期**: 加强存活病例管理（降低传播风险）

---

### 图表3: 全局重要性图解读

**图表结构**:
```
排名  特征名称              重要性分数    百分比
1.   存活数               0.1985      19.85%  ========>
2.   新报告               0.1812      18.12%  =======>
3.   病载<50比例          0.0705       7.05%  ===>
```

**颜色含义**:
- 🔴 **红色/橙色**: 非常重要
- 🟡 **黄色**: 重要
- 🟢 **绿色**: 相对不太重要

**数值含义**:
- **重要性分数**: 该特征在所有预测中的平均影响
- **百分比**: 该特征占总重要性的比例

**如何使用**:

1. **了解模型关注点**:
   - Top 3特征通常占40-50%的重要性
   - 这些是模型最关注的指标

2. **指导数据收集**:
   - 重要性高的特征 → 数据质量要求高
   - 重要性低的特征 → 可以适当放宽

3. **验证模型合理性**:
   - 检查Top特征是否符合医学常识
   - 例如: 存活数、新报告应该很重要 ✓

**解读示例**:

假设图表显示：
```
1. 存活数 (19.85%)
2. 新报告 (18.12%)
3. 病载<50比例 (7.05%)
4. 感染率 (5.39%)
5. 筛查覆盖率 (5.10%)
```

**解读**:
1. **Top 2特征占38%**: 存活数和新报告是最关键的指标
2. **治疗指标重要**: 病载<50比例排第3，说明治疗效果很重要
3. **预防指标也重要**: 筛查覆盖率排第5
4. **模型合理**: 这些特征都符合疾控工作的重点

**应用建议**:
- **数据收集**: 优先保证Top 10特征的数据质量
- **监测重点**: 重点监测存活数、新报告的变化
- **干预重点**: 提高治疗效果（病载<50比例）和筛查覆盖率

---

## 🎓 实际应用案例

### 案例1: 高风险区县分析

**背景**: 某区县被评为等级5（极高风险）

**瀑布图显示**:
```
存活数: +0.82 (红色，最长)
新报告: +0.65 (红色，长)
感染率: +0.48 (红色，中)
商业性传播: +0.32 (红色，中)
治疗覆盖率: -0.15 (蓝色，短)
```

**解读**:
1. **主要问题**: 疫情基数大（存活数多）、传播活跃（新报告多）
2. **次要问题**: 感染率高、商业性传播突出
3. **保护不足**: 治疗覆盖率的保护作用较弱

**对比图显示**:
- 左侧（风险）条很长
- 右侧（保护）条很短
- 明显失衡

**全局重要性图**:
- 存活数、新报告都在Top 2
- 说明这两个指标确实是关键

**干预建议**:
1. 🚨 **紧急**: 提高治疗覆盖率到95%以上
2. 🚨 **重点**: 加强商业性行为场所干预
3. 🚨 **持续**: 扩大筛查范围，早发现早治疗

---

### 案例2: 低风险区县分析

**背景**: 某区县被评为等级1（极低风险）

**瀑布图显示**:
```
筛查人数: -0.45 (蓝色，最长)
治疗覆盖率: -0.32 (蓝色，长)
病毒抑制: -0.28 (蓝色，中)
存活数: +0.15 (红色，短)
新报告: +0.08 (红色，很短)
```

**解读**:
1. **保护因素强**: 筛查工作到位、治疗效果好
2. **风险因素弱**: 存活数少、新报告少
3. **防控有效**: 负贡献远大于正贡献

**对比图显示**:
- 左侧（风险）条很短
- 右侧（保护）条很长
- 保护因素占主导

**干预建议**:
1. ✅ **保持**: 继续现有防控措施
2. ✅ **监测**: 定期监测重点人群
3. ✅ **经验**: 总结经验推广到其他区县

---

## 💡 使用技巧

### 技巧1: 三图联合分析

**步骤**:
1. 先看**对比图** → 快速判断风险水平
2. 再看**瀑布图** → 详细了解各特征贡献
3. 最后看**重要性图** → 验证关键因素

### 技巧2: 重点关注

**瀑布图**:
- 重点看贡献度 > 0.3 的特征
- 这些是主要影响因素

**对比图**:
- 重点看Top 3特征
- 这些是最需要干预的

**重要性图**:
- 重点看Top 10特征
- 这些是模型的核心关注点

### 技巧3: 制定措施

**基于瀑布图**:
- 正贡献大 → 减少风险因素
- 负贡献小 → 增强保护因素

**基于对比图**:
- 左侧长 → 控制风险
- 右侧短 → 加强防护

**基于重要性图**:
- 重要性高 → 优先改善
- 重要性低 → 次要关注

---

## 🔧 故障排查

### 问题1: 图表中文乱码

**原因**: 系统缺少中文字体

**解决方案**:
```bash
# 安装中文字体
sudo apt-get install -y fonts-wqy-microhei fonts-wqy-zenhei

# 清除matplotlib缓存
rm -rf ~/.cache/matplotlib

# 重新生成图表
python3 visualize_contributions.py
```

### 问题2: 图表不清晰

**原因**: 分辨率不够

**解决方案**: 图表已设置为300 DPI，如需更高：
```python
plt.savefig(save_path, dpi=600, bbox_inches='tight')  # 改为600 DPI
```

### 问题3: 特征名称太长

**原因**: 特征名称被截断

**解决方案**: 调整图表大小
```python
fig, ax = plt.subplots(figsize=(14, 10))  # 增大尺寸
```

---

## 📞 更多帮助

**相关文档**:
- 模型可解释性: `MODEL_INTERPRETABILITY.md`
- API使用指南: `API_ENHANCED_GUIDE.md`
- 快速开始: `QUICK_START_ENHANCED.md`

**示例代码**:
- 可视化工具: `visualize_contributions.py`

---

**版本**: 1.0  
**最后更新**: 2025-11-04  
**维护者**: 刘俊希
